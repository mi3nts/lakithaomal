% Auto-generated by stereoCalibrator app on 10-Apr-2020
%-------------------------------------------------------

clc
close all 
clear all 

saveNamePrePython    = 'DF_002_pythonVisualJetson'
saveNamePreMatLabAll = 'DF_002_visualParametorsJetson'
saveNamePreMatLab    = 'DF_002_visualParametorsJetsonStereo'

addpath("functions/")

jetsonSN    = '002'
setNum      = '1'


% Define images to process
imageFileNames1 = {...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_53_12_951848_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_53_36_036249_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_53_54_772552_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_54_20_326969_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_54_41_284758_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_55_11_759111_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_55_56_060261_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_56_30_993626_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_57_00_937629_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_57_31_509844_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_58_05_900426_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_58_53_118418_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_19_59_32_610982_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_00_03_014975_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_00_38_070443_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_01_28_096171_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_01_56_644711_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_03_06_284881_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_04_26_111613_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_05_02_687697_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_05_26_049710_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_05_51_379794_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_06_51_695544_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_07_28_784957_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_07_53_843112_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_08_17_765157_leftResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_08_46_031450_leftResized.jpg',...
%     '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_09_27_359458_leftResized.jpg',...
%     '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_09_56_767414_leftResized.jpg',...
%     '/home/teamlary/mintsData/jetson002Set1/leftResized/2020_04_09_20_10_22_395123_leftResized.jpg',...
    };

imageFileNames2 = {...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_53_12_951848_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_53_36_036249_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_53_54_772552_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_54_20_326969_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_54_41_284758_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_55_11_759111_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_55_56_060261_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_56_30_993626_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_57_00_937629_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_57_31_509844_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_58_05_900426_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_58_53_118418_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_19_59_32_610982_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_00_03_014975_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_00_38_070443_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_01_28_096171_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_01_56_644711_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_03_06_284881_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_04_26_111613_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_05_02_687697_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_05_26_049710_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_05_51_379794_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_06_51_695544_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_07_28_784957_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_07_53_843112_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_08_17_765157_rightResized.jpg',...
    '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_08_46_031450_rightResized.jpg',...
%     '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_09_27_359458_rightResized.jpg',...
%     '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_09_56_767414_rightResized.jpg',...
%     '/home/teamlary/mintsData/jetson002Set1/rightResized/2020_04_09_20_10_22_395123_rightResized.jpg',...
    };

% Detect checkerboards in images
[imagePoints, boardSize, imagesUsed] = detectCheckerboardPoints(imageFileNames1, imageFileNames2);


% Generate world coordinates of the checkerboard keypoints
squareSize = 35;  % in units of 'millimeters'
worldPoints = generateCheckerboardPoints(boardSize, squareSize);

% Read one of the images from the first stereo pair
I1 = imread(imageFileNames1{1});
[mrows, ncols, ~] = size(I1);

% Calibrate the camera
[stereoParamsLeftAndRight, pairsUsed, estimationErrors] = estimateCameraParameters(imagePoints, worldPoints, ...
    'EstimateSkew', false, 'EstimateTangentialDistortion', false, ...
    'NumRadialDistortionCoefficients', 2, 'WorldUnits', 'millimeters', ...
    'InitialIntrinsicMatrix', [], 'InitialRadialDistortion', [], ...
    'ImageSize', [mrows, ncols]);

% View reprojection errors
h1=figure; showReprojectionErrors(stereoParamsLeftAndRight);

% Visualize pattern locationsleftAnd
h2=figure; showExtrinsics(stereoParamsLeftAndRight, 'CameraCentric');

% Display parameter estimation errors
displayErrors(estimationErrors, stereoParamsLeftAndRight);

% You can use the calibration data to rectify stereo images.
I2 = imread(imageFileNames2{1});
[J1, J2] = rectifyStereoImages(I1, I2, stereoParamsLeftAndRight);

% Saving Data Products
leftImagePoints = imagePoints(:,:,:,1);
rightImagePoints= imagePoints(:,:,:,2);

save(getSaveNameJetson(saveNamePreMatLabAll,jetsonSN,setNum))
save(getSaveNameJetson(saveNamePreMatLab,jetsonSN,setNum),'stereoParamsLeftAndRight')
save(getSaveNameJetson(saveNamePrePython,jetsonSN,setNum),...
        'imageFileNames1','imageFileNames2',...
        'imagePoints','leftImagePoints','rightImagePoints'...
        )


